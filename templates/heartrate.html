{% extends "page.html" %}
{% block title %}Digital Bushman : Heartrate{% endblock title %}

{% block body %}

<div id="imagediv"></div>

<script language="Javascript" type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script language="Javascript" type="text/javascript" src="/static/js/simplify.js"></script>
<script src="http://d3js.org/d3.v3.js"></script>
<script language="Javascript" type="text/javascript" src="/static/js/nv.d3.js"></script>

<style type="text/css">
		path {

		    stroke-width: 1;
		    fill: none;
		}

		line {
		    stroke: black;
		}

		text {
		    font-family: Arial;
		    font-size: 9pt;
		}
</style>
<script type="text/javascript">
	console.log('fetching images');
	$.getJSON('/api/timeline?date=20130913&types=ambit&days=1', function(data) {
		console.log(data);

		var heartLines = [];
		
		for (var i = 0; i < data.features.length; i++) {
			var f = data.features[i];	
			var n = f.properties.Person;
			if (heartLines[n] == undefined) heartLines[n] = [];
			if {f.properties.HR != undefined && f.properties.t_utc != undefined) {
				heartLines[n].push({"x":f.properties.t_utc, "y":f.properties.HR});		
			}
		}

		for (var n in heartLines) {
			heartLines[n] = simplify(heartLines[n], 0.05, false);
		}

		var dat = [
			{
				values:heartLines["Steve"],
				key: "Steve",
				color:'#ff3300'
			},
			{
				values:heartLines["John"],
				key: "John",
				color:'#ff9900'
			},
			{
				values:heartLines["GB"],
				key: "GB",
				color:'#ffff00'
			}

		];

		console.log(dat);

		nv.addGraph(function() {
		  var chart = nv.models.lineChart();

		  chart.xAxis
		      .axisLabel('Time (ms)')
		      .tickFormat(d3.format(',r'));

		  chart.yAxis
		      .axisLabel('Voltage (v)')
		      .tickFormat(d3.format('.02f'));

		  d3.select('#chart svg')
		      .datum(dat)
		      .transition().duration(500)
		      .call(chart);

		  nv.utils.windowResize(chart.update);

		  return chart;
		});

		

	});
</script>

<style>

#chart svg {
  height: 400px;
}

</style>


<div id="chart">
  <svg></svg>
</div>


{% endblock body %}