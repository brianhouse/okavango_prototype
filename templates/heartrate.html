{% extends "page.html" %}
{% block title %}Digital Bushman : Heartrate{% endblock title %}

{% block body %}

<div id="imagediv"></div>

<script language="Javascript" type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script language="Javascript" type="text/javascript" src="/static/js/simplify.js"></script>
<script src="http://d3js.org/d3.v3.js"></script>
<style type="text/css">
		path {

		    stroke-width: 1;
		    fill: none;
		}

		line {
		    stroke: black;
		}

		text {
		    font-family: Arial;
		    font-size: 9pt;
		}
</style>
<script type="text/javascript">
	console.log('fetching images');
	$.getJSON('/api/timeline?date=20130909&types=ambit&days=1', function(data) {
		console.log(data);

		var heartLines = [];
		
		for (var i = 0; i < data.features.length; i++) {
			var f = data.features[i];	
			var n = f.properties.Person;
			if (heartLines[n] == undefined) heartLines[n] = [];
			heartLines[n].push({"x":f.properties.t_utc, "y":f.properties.HR});		
		}

		for (var n in heartLines) {
			heartLines[n] = simplify(heartLines[n], 0.05, false);
			//console.log(heartLines[n]);
		}

		var width = 1200;
		var height = 400;
		var margin = 50;

		var names = ["Steve", "John", "GB"];
		var colors = ["#FF3300", "#FF9900", "#FFFF00"]

			var n = names[0];

			var st = heartLines[n][0].x;
			var et = heartLines[n][heartLines[n].length - 1].x;

			console.log(st + ":" + et);

			var y = d3.scale.linear().domain([0,5]).range([0 + margin, height - margin]);
			var x = d3.scale.linear().domain([st, et]).range([0 + margin, width - margin]);

			var vis = d3.select("body")
			    .append("svg:svg")
			    .attr("width", width)
			    .attr("height", height)
			 
			var g = vis.append("svg:g")
			    .attr("transform", "translate(0, 400)");

			var line = d3.svg.line()
			    .x(function(d) { return x(d.x); })
			    .y(function(d) { return -1 * y(d.y); })

			for (var i = 0; i < names.length; i++) {
				console.log(names[i]);
				g.append("svg:path").attr("d", line(heartLines[names[i]])).attr("stroke", colors[i]);;
			}
				
			g.append("svg:line")
			    .attr("x1", x(st))
			    .attr("y1", -1 * y(0))
			    .attr("x2", x(et))
			    .attr("y2", -1 * y(0))
			 
			g.append("svg:line")
			    .attr("x1", x(st))
			    .attr("y1", -1 * y(0))
			    .attr("x2", x(st))
			    .attr("y2", -1 * y(5))

			g.selectAll(".xLabel")
			    .data(x.ticks(5))
			    .enter().append("svg:text")
			    .attr("class", "xLabel")
			    .text(String)
			    .attr("x", function(d) { 
			    	console.log("xlabel:" + d);
			    	console.log("xlabel:" + x(d.x);
			    	return x(d.x) 
			    })
			    .attr("y", 0)
			    .attr("text-anchor", "middle")
			 
			g.selectAll(".yLabel")
			    .data(y.ticks(4))
			    .enter().append("svg:text")
			    .attr("class", "yLabel")
			    .text(String)
			    .attr("x", 0)
			    .attr("y", function(d) { 
			    	console.log("ylabel:" + d);
			    	console.log("ylabel:" + y(d.y);
			    	return -1 * y(d.y) 
			    })
			    .attr("text-anchor", "right")
			    .attr("dy", 4)

			/*
			g.selectAll(".xTicks")
			    .data(x.ticks(5))
			    .enter().append("svg:line")
			    .attr("class", "xTicks")
			    .attr("x1", function(d) { return x(d.x); })
			    .attr("y1", -1 * y(0))
			    .attr("x2", function(d) { return x(d.x); })
			    .attr("y2", -1 * y(-0.3))
			*/
			 
			g.selectAll(".yTicks")
			    .data(y.ticks(4))
			    .enter().append("svg:line")
			    .attr("class", "yTicks")
			    .attr("y1", function(d) { return -1 * y(d.y); })
			    .attr("x1", x(st))
			    .attr("y2", function(d) { return -1 * y(d.y); })
			    .attr("x2", x(st))
			
		

	});
</script>

{% endblock body %}