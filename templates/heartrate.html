{% extends "page.html" %}
{% block title %}Digital Bushman : Heartrate{% endblock title %}

{% block body %}

<div id="imagediv"></div>

<script language="Javascript" type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script language="Javascript" type="text/javascript" src="/static/js/simplify.js"></script>
<script src="http://d3js.org/d3.v3.js"></script>
<script type="text/javascript">
	console.log('fetching images');
	$.getJSON('/api/timeline?date=20130907&types=ambit&days=100', function(data) {
		console.log(data);

		var heartLines = [];
		
		for (var i = 0; i < data.features.length; i++) {
			var f = data.features[i];	
			var n = f.properties.Person;
			if (heartLines[n] == undefined) heartLines[n] = [];
			heartLines[n].push({"x":f.properties.t_utc, "y":f.properties.HR});		
		}

		for (var n in heartLines) {
			console.log(n);
			console.log(heartLines[n].length);
			heartLines[n] = simplify(heartLines[n], 0.1, false);
			console.log(heartLines[n].length);
		}

		var width = 800;
		var height = 400;
		var margin = 20;

		var st = heartLines["Steve"][0].x;
		var et = heartLines["Steve"][heartLines["Steve"].length - 1].x;
		var y = d3.scale.linear().domain([0,5]).range([0 + margin, height - margin]);
		var x = d3.scale.linear().domain([st, et]).range([0 + margin, width - margin]);

		var vis = d3.select("body")
		    .append("svg:svg")
		    .attr("width", width)
		    .attr("height", height)
		 
		var g = vis.append("svg:g")
		    .attr("transform", "translate(0, 200)");

		var line = d3.svg.line()
		    .x(function(d,i) { return x(i); })
		    .y(function(d) { return -1 * y(d); })

		g.append("svg:path").attr("d", line(heartLines["Steve"]));

	});
</script>

{% endblock body %}